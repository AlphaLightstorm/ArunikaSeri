<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Link Hub</title>
  <meta name="description" content="Professional link hub for creators" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <!-- Firebase SDKs (compat) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

  <style>
    :root{
      --bg:#f6fbff; --card:#ffffff; --muted:#6b7b8c; --accent:#1e90ff; --accent-2:#00b4ff;
      --glass: rgba(30,144,255,0.06); --radius:18px; --max-width:880px; --shadow: 0 18px 48px rgba(20,40,80,0.06);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
      background:linear-gradient(180deg,#f8fbff 0%,#eef7ff 100%); color:#0b1b2b;
      display:flex; align-items:center; justify-content:center; padding:28px;
    }
    .wrap{ width:100%; max-width:var(--max-width); background:var(--card); border-radius:20px; padding:24px; box-shadow:var(--shadow); border:1px solid rgba(15,30,60,0.04); }
    header{ display:flex; gap:18px; align-items:center; margin-bottom:20px; }
    .avatar{ width:112px; height:112px; border-radius:16px; overflow:hidden; flex:0 0 112px; border:1px solid rgba(30,144,255,0.12); background:linear-gradient(135deg,var(--accent),var(--accent-2)); display:flex; align-items:center; justify-content:center; font-weight:700; font-size:32px; color:white; position:relative; }
    .avatar img{ width:100%; height:100%; object-fit:cover; display:block }
    .avatar .edit{ position:absolute; right:8px; bottom:8px; background:rgba(255,255,255,0.95); color:var(--accent); border-radius:10px; padding:6px 8px; font-size:13px; cursor:pointer; border:1px solid rgba(15,30,60,0.04); }
    .profile{ flex:1; min-width:0; }
    .name{ font-size:22px; font-weight:700; margin-bottom:6px; }
    .tagline{ color:var(--muted); font-size:14px; margin-bottom:8px; }
    .profile .desc{ color:var(--muted); font-size:14px; margin-top:6px; }
    .controls{ display:flex; gap:8px; align-items:center; }
    .btn{ background:transparent; border:1px solid rgba(15,30,60,0.06); color:var(--muted); padding:10px 14px; border-radius:12px; font-size:14px; cursor:pointer; display:inline-flex; gap:10px; align-items:center; }
    .btn.primary{ background:linear-gradient(90deg,var(--accent),var(--accent-2)); color:white; border:none; font-weight:700; }
    main{ display:grid; gap:16px; margin-top:8px; max-height:72vh; overflow:auto; padding-right:6px; }
    .card{ display:flex; align-items:center; gap:16px; padding:18px; border-radius:14px; background:linear-gradient(180deg, rgba(240,248,255,0.95), rgba(255,255,255,0.98)); border:1px solid rgba(15,30,60,0.04); transition:transform .12s ease, box-shadow .12s ease; cursor:pointer; }
    .card:hover{ transform:translateY(-6px); box-shadow:0 18px 40px rgba(20,40,80,0.06) }
    .card .thumb{ width:96px; height:96px; border-radius:12px; background:var(--glass); display:flex; align-items:center; justify-content:center; font-weight:700; color:var(--accent); flex:0 0 96px; overflow:hidden; position:relative; }
    .thumb img{ width:100%; height:100%; object-fit:cover; display:block }
    .thumb .placeholder{ font-size:22px; color:var(--accent) }
    .card .meta{ flex:1; min-width:0; }
    .label{ font-weight:800; font-size:18px; margin-bottom:6px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .url{ color:var(--muted); font-size:14px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
    .right{ display:flex; gap:10px; align-items:center; }
    .icon{ width:48px; height:48px; border-radius:12px; display:inline-grid; place-items:center; background:rgba(15,30,60,0.03); color:var(--muted); font-size:16px; cursor:pointer; }
    .counter{ font-size:13px; color:var(--muted); background:rgba(15,30,60,0.03); padding:8px 10px; border-radius:999px; }
    .modal{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:60; background:linear-gradient(180deg, rgba(10,20,30,0.35), rgba(10,20,30,0.35)); padding:20px; }
    .modal.open{ display:flex }
    .panel{ width:100%; max-width:720px; background:var(--card); border-radius:14px; padding:18px; border:1px solid rgba(15,30,60,0.04); box-shadow:0 12px 30px rgba(10,20,30,0.08); }
    .field{ display:flex; flex-direction:column; gap:8px; margin-bottom:12px }
    label{ color:var(--muted); font-size:13px }
    input[type="text"], textarea{ padding:12px 14px; border-radius:10px; border:1px solid rgba(15,30,60,0.06); background:transparent; color:inherit; outline:none; font-size:15px; }
    textarea{ min-height:80px; resize:vertical; }
    .row{ display:flex; gap:10px; justify-content:flex-end; margin-top:6px }
    .small{ font-size:13px; color:var(--muted) }
    footer{ margin-top:16px; display:flex; justify-content:space-between; align-items:center; gap:12px; color:var(--muted); font-size:13px; }
    .adminBadge{ background:linear-gradient(90deg,var(--accent),var(--accent-2)); color:white; padding:6px 10px; border-radius:999px; font-weight:700; font-size:13px; }
    @media (max-width:720px){ .avatar{ width:88px; height:88px; flex:0 0 88px } .card .thumb{ width:76px; height:76px; flex:0 0 76px } .label{ font-size:16px } }
    .links-grid{display:grid;gap:14px;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));margin-top:18px}
.card{background:#fff;border:1px solid #e9edf3;border-radius:10px;padding:10px;box-shadow:0 1px 0 rgba(16,24,40,0.02)}
.thumb{width:100%;height:130px;object-fit:cover;border-radius:6px;background:#f0f2f6}
.title{display:block;margin-top:10px;font-weight:600;color:#111;text-decoration:none}
.meta{margin-top:8px;color:#6b7280;font-size:13px}
.notice{padding:12px;border-radius:8px;background:#fff;border:1px dashed #e6e9ef;color:#6b7280}
@media (max-width:520px){.thumb{height:110px}}

  </style>
</head>
<body>
  <div class="wrap" role="application" aria-label="Link hub">
    <header>
      <div class="avatar" id="avatar">
        <img id="avatarImg" alt="Profile" style="display:none" />
        <div id="avatarInitials">AL</div>
        <div class="edit" id="avatarEdit" title="Edit avatar URL">Edit</div>
      </div>

      <div class="profile">
        <div class="name" id="displayName">Your Name</div>
        <div class="tagline" id="tagline">Creator ‚Ä¢ TikTok Monetization</div>
        <div class="desc" id="description">Short description or call to action goes here.</div>
      </div>

      <div class="controls" id="controls">
        <button class="btn" id="importBtn" title="Import links">Import</button>
        <button class="btn" id="exportBtn" title="Export links">Export</button>
        <button class="btn" id="addBtn" title="Add link">Add Link</button>
        <button class="btn primary" id="editProfile">Edit Profile</button>
        <button class="btn" id="adminBtn">Admin</button>
      </div>
    </header>

    <main id="list" aria-live="polite"></main>

    <footer>
      <div class="small">Light blue theme ‚Ä¢ Mobile-first</div>
      <div class="small">Public read ‚Ä¢ Admin edits via Firebase</div>
    </footer>
  </div>

  <!-- Link Editor Modal -->
  <div class="modal" id="modal" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="panel" role="document">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <strong id="modalTitle">Edit Link</strong>
        <button class="btn" id="closeModal">Close</button>
      </div>

      <div class="field">
        <label for="labelInput">Button Label</label>
        <input id="labelInput" type="text" placeholder="e.g., Support Me" />
      </div>

      <div class="field">
        <label for="urlInput">URL</label>
        <input id="urlInput" type="text" placeholder="https://example.com" />
      </div>

      <div class="field">
        <label for="thumbUrlInput">Thumbnail Image URL</label>
        <input id="thumbUrlInput" type="text" placeholder="https://yoursite.netlify.app/assets/thumb1.jpg" />
        <div id="thumbPreview" style="margin-top:8px"></div>
      </div>

      <div class="row">
        <button class="btn" id="deleteLink">Delete</button>
        <button class="btn primary" id="saveLink">Save</button>
      </div>
    </div>
  </div>

  <!-- Admin Login Modal -->
  <div class="modal" id="adminModal" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="panel" role="document">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <strong>Admin Sign In</strong>
        <button class="btn" id="closeAdmin">Close</button>
      </div>

      <div class="field">
        <label for="adminEmail">Email</label>
        <input id="adminEmail" type="text" placeholder="admin@example.com" />
      </div>
      <div class="field">
        <label for="adminPassword">Password</label>
        <input id="adminPassword" type="password" placeholder="Your password" />
      </div>

      <div class="row">
        <button class="btn" id="adminSignOut" style="display:none">Sign Out</button>
        <button class="btn primary" id="adminSignIn">Sign In</button>
      </div>
      <div style="margin-top:12px;color:var(--muted);font-size:13px">
        Tip: Upload images to your repo under assets and paste the public URL here.
      </div>
    </div>
  </div>
    <div id="links" class="links-grid">
  <div class="notice">Loading links‚Ä¶</div>
</div>
  <script>
    /***** CONFIGURE FIREBASE *****/
    // Your web app's Firebase configuration (inserted)
    const firebaseConfig = {
      apiKey: "AIzaSyCW2FCqNGxiv67BEPfZ2Xw29A_vNM-a2uE",
      authDomain: "arunikaseri.firebaseapp.com",
      projectId: "arunikaseri",
      storageBucket: "arunikaseri.appspot.com",
      messagingSenderId: "762408001942",
      appId: "1:762408001942:web:7d45097875281e8545fdb7",
      measurementId: "G-HFMT3D9L04"
    };

    // Initialize Firebase (compat)
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // Document id to store public data
    const PUBLIC_DOC = 'public'; // collection 'linkhubs' doc 'public'

    /***** UI ELEMENTS *****/
    const listEl = document.getElementById('list');
    const modal = document.getElementById('modal');
    const labelInput = document.getElementById('labelInput');
    const urlInput = document.getElementById('urlInput');
    const thumbUrlInput = document.getElementById('thumbUrlInput');
    const thumbPreview = document.getElementById('thumbPreview');
    const modalTitle = document.getElementById('modalTitle');
    const saveLinkBtn = document.getElementById('saveLink');
    const deleteLinkBtn = document.getElementById('deleteLink');
    const closeModalBtn = document.getElementById('closeModal');
    const exportBtn = document.getElementById('exportBtn');
    const importBtn = document.getElementById('importBtn');
    const editProfileBtn = document.getElementById('editProfile');
    const addBtn = document.getElementById('addBtn');
    const adminBtn = document.getElementById('adminBtn');

    const displayName = document.getElementById('displayName');
    const tagline = document.getElementById('tagline');
    const description = document.getElementById('description');
    const avatarImg = document.getElementById('avatarImg');
    const avatarInitials = document.getElementById('avatarInitials');
    const avatarEdit = document.getElementById('avatarEdit');

    const adminModal = document.getElementById('adminModal');
    const adminEmail = document.getElementById('adminEmail');
    const adminPassword = document.getElementById('adminPassword');
    const adminSignInBtn = document.getElementById('adminSignIn');
    const adminSignOutBtn = document.getElementById('adminSignOut');
    const closeAdminBtn = document.getElementById('closeAdmin');

    /***** STORAGE KEYS & DEFAULTS *****/
    const STORAGE_KEY = 'linkhub_v3';
    const PROFILE_KEY = 'linkhub_profile_v3';
    const DEFAULT = [
      { id: 'l1', label: 'TikTok', url: 'https://www.tiktok.com/@yourhandle', thumb: '', clicks: 0 },
      { id: 'l2', label: 'YouTube', url: 'https://youtube.com', thumb: '', clicks: 0 },
      { id: 'l3', label: 'Affiliate', url: 'https://example.com', thumb: '', clicks: 0 }
    ];

    /***** STATE *****/
    let links = [];
    let currentEditId = null;

    /***** Local storage helpers *****/
    function loadLinksLocal(){
      try{ const raw = localStorage.getItem(STORAGE_KEY); if(raw) return JSON.parse(raw); }catch(e){}
      localStorage.setItem(STORAGE_KEY, JSON.stringify(DEFAULT));
      return JSON.parse(JSON.stringify(DEFAULT));
    }
    function saveLinksLocal(){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(links));
    }
    function loadProfileLocal(){
      try{ return JSON.parse(localStorage.getItem(PROFILE_KEY) || '{}'); }catch(e){ return {}; }
    }
    function saveProfileLocal(p){ localStorage.setItem(PROFILE_KEY, JSON.stringify(p)); }

    /***** Firestore read/write *****/
    async function loadFromServerOrLocal(){
      // Try Firestore first
      try{
        const doc = await db.collection('linkhubs').doc(PUBLIC_DOC).get();
        if(doc.exists){
          const data = doc.data();
          if(data.profile) saveProfileLocal(data.profile);
          if(Array.isArray(data.links)){ links = data.links; saveLinksLocal(); render(); loadProfileToUI(); return; }
        }
      }catch(e){
        console.warn('Firestore read failed, falling back to local', e);
      }
      // fallback
      links = loadLinksLocal();
      loadProfileToUI();
      render();
    }

    async function saveToServer(){
      // Only call when admin signed in
      const payload = { profile: loadProfileLocal(), links };
      try{
        await db.collection('linkhubs').doc(PUBLIC_DOC).set(payload);
        saveLinksLocal();
        return true;
      }catch(e){
        console.error('Save to server failed', e);
        return false;
      }
    }

    /***** Render UI *****/
    function render(){
      listEl.innerHTML = '';
      links.forEach(item => {
        const card = document.createElement('div');
        card.className = 'card';
        card.dataset.id = item.id;

        const thumbHtml = item.thumb
          ? `<div class="thumb"><img src="${escapeHtml(item.thumb)}" alt="${escapeHtml(item.label)}" loading="lazy" /></div>`
          : `<div class="thumb"><div class="placeholder">${escapeHtml(item.label.slice(0,2).toUpperCase())}</div></div>`;

        card.innerHTML = `
          ${thumbHtml}
          <div class="meta">
            <div class="label">${escapeHtml(item.label)}</div>
            <div class="url">${escapeHtml(item.url)}</div>
          </div>
          <div class="right">
            <div class="counter" title="Clicks">${item.clicks || 0}</div>
            <div class="icon" data-action="edit" title="Edit">‚úèÔ∏è</div>
            <div class="icon" data-action="copy" title="Copy URL">üìã</div>
          </div>
        `;

        card.addEventListener('click', (e) => {
          const action = e.target.closest('[data-action]')?.dataset.action;
          const id = card.dataset.id;
          if(action === 'edit'){ openEditor(id); e.stopPropagation(); return; }
          if(action === 'copy'){ copyUrl(id); e.stopPropagation(); return; }
          const link = links.find(l => l.id === id);
          if(link && link.url){
            window.open(link.url, '_blank', 'noopener');
            incrementClick(id);
          }
        });

        listEl.appendChild(card);
      });
      updateAdminUI();
    }

    function openEditor(id){
      currentEditId = id;
      const item = links.find(l => l.id === id) || {};
      modalTitle.textContent = id ? 'Edit Link' : 'New Link';
      labelInput.value = item.label || '';
      urlInput.value = item.url || '';
      thumbUrlInput.value = item.thumb || '';
      renderThumbPreview(item.thumb || '');
      modal.classList.add('open');
      modal.setAttribute('aria-hidden','false');
      labelInput.focus();
    }
    function closeEditor(){
      currentEditId = null;
      thumbUrlInput.value = '';
      thumbPreview.innerHTML = '';
      modal.classList.remove('open');
      modal.setAttribute('aria-hidden','true');
    }

    saveLinkBtn.addEventListener('click', async () => {
      if(!isAdmin()) return alert('Admin only');
      const label = labelInput.value.trim() || 'Untitled';
      let url = urlInput.value.trim();
      if(url && !/^https?:\/\//i.test(url)) url = 'https://' + url;
      const thumbUrl = thumbUrlInput.value.trim();

      if(currentEditId){
        const idx = links.findIndex(l => l.id === currentEditId);
        if(idx > -1){
          links[idx].label = label;
          links[idx].url = url;
          links[idx].thumb = thumbUrl;
        }
      } else {
        const id = 'l' + Date.now();
        links.unshift({ id, label, url, thumb: thumbUrl, clicks: 0 });
      }
      saveLinksLocal();
      const ok = await saveToServer();
      if(!ok) alert('Saved locally but failed to save to server');
      render();
      closeEditor();
    });

    deleteLinkBtn.addEventListener('click', async () => {
      if(!isAdmin()) return alert('Admin only');
      if(!currentEditId) return;
      links = links.filter(l => l.id !== currentEditId);
      saveLinksLocal();
      const ok = await saveToServer();
      if(!ok) alert('Deleted locally but failed to save to server');
      render();
      closeEditor();
    });

    closeModalBtn.addEventListener('click', closeEditor);
    modal.addEventListener('click', (e) => { if(e.target === modal) closeEditor(); });

    function incrementClick(id){
      const idx = links.findIndex(l => l.id === id);
      if(idx > -1){
        links[idx].clicks = (links[idx].clicks || 0) + 1;
        saveLinksLocal();
        // Optionally persist clicks to server (not required)
        render();
      }
    }
    function copyUrl(id){
      const item = links.find(l => l.id === id);
      if(!item) return;
      navigator.clipboard?.writeText(item.url || '')?.then(() => {
        const el = document.querySelector(`.card[data-id="${id}"] .icon[data-action="copy"]`);
        if(el){ el.textContent = '‚úÖ'; setTimeout(()=>el.textContent='üìã',900); }
      });
    }

    /***** Export / Import *****/
    exportBtn.addEventListener('click', () => {
      const payload = { profile: loadProfileLocal(), links };
      navigator.clipboard?.writeText(JSON.stringify(payload, null, 2));
      exportBtn.textContent = 'Copied';
      setTimeout(()=>exportBtn.textContent='Export',1200);
    });

    importBtn.addEventListener('click', async () => {
      if(!isAdmin()) return alert('Admin only');
      const raw = prompt('Paste exported JSON here');
      if(!raw) return;
      try{
        const parsed = JSON.parse(raw);
        if(parsed.profile) saveProfileLocal(parsed.profile);
        if(Array.isArray(parsed.links)) links = parsed.links;
        saveLinksLocal();
        const ok = await saveToServer();
        if(!ok) alert('Imported locally but failed to save to server');
        render();
        loadProfileToUI();
        importBtn.textContent = 'Imported';
        setTimeout(()=>importBtn.textContent='Import',1200);
      }catch(e){
        alert('Invalid JSON');
      }
    });

    /***** Add / Edit Profile *****/
    addBtn.addEventListener('click', () => {
      if(!isAdmin()) return alert('Admin only');
      currentEditId = null;
      modalTitle.textContent = 'New Link';
      labelInput.value = '';
      urlInput.value = '';
      thumbUrlInput.value = '';
      renderThumbPreview('');
      modal.classList.add('open');
      modal.setAttribute('aria-hidden','false');
      labelInput.focus();
    });

    editProfileBtn.addEventListener('click', async () => {
      if(!isAdmin()) return alert('Admin only');
      // Use prompt flow for simplicity; you can replace with a nicer modal
      const p = loadProfileLocal();
      const name = prompt('Display name', p.name || displayName.textContent) || displayName.textContent;
      const tag = prompt('Tagline', p.tag || tagline.textContent) || tagline.textContent;
      const desc = prompt('Short description', p.desc || description.textContent) || description.textContent;
      const avatarUrl = prompt('Avatar image URL (paste GitHub/Netlify URL)', p.avatarUrl || '') || (p.avatarUrl || '');
      const initials = name.split(' ').map(s=>s[0]).slice(0,2).join('').toUpperCase();
      const profile = { name, tag, desc, initials, avatarUrl };
      saveProfileLocal(profile);
      const ok = await saveToServer();
      if(!ok) alert('Profile saved locally but failed to save to server');
      loadProfileToUI();
    });

    avatarEdit.addEventListener('click', async () => {
      if(!isAdmin()) return alert('Admin only');
      const p = loadProfileLocal();
      const avatarUrl = prompt('Avatar image URL (paste GitHub/Netlify URL)', p.avatarUrl || '') || (p.avatarUrl || '');
      p.avatarUrl = avatarUrl;
      saveProfileLocal(p);
      const ok = await saveToServer();
      if(!ok) alert('Avatar saved locally but failed to save to server');
      loadProfileToUI();
    });

    function loadProfileToUI(){
      const p = loadProfileLocal();
      if(p.name) displayName.textContent = p.name;
      if(p.tag) tagline.textContent = p.tag;
      if(p.desc) description.textContent = p.desc;
      if(p.avatarUrl){
        avatarImg.src = p.avatarUrl;
        avatarImg.style.display = 'block';
        avatarInitials.style.display = 'none';
      } else {
        avatarImg.style.display = 'none';
        avatarInitials.style.display = p.initials || 'AL';
      }
    }

    function renderThumbPreview(url){
      if(!url){
        thumbPreview.innerHTML = '<div style="color:var(--muted);font-size:13px">No thumbnail selected</div>';
        return;
      }
      thumbPreview.innerHTML = `<img src="${escapeHtml(url)}" style="width:160px;height:100px;object-fit:cover;border-radius:8px;border:1px solid rgba(15,30,60,0.04)" alt="thumb preview" loading="lazy" />`;
    }

    /***** Admin auth flow *****/
    function isAdmin(){
      return sessionStorage.getItem('isAdmin') === '1';
    }

    adminBtn.addEventListener('click', () => {
      // open admin modal
      adminModal.classList.add('open');
      adminModal.setAttribute('aria-hidden','false');
      adminEmail.focus();
    });
    closeAdminBtn.addEventListener('click', () => {
      adminModal.classList.remove('open');
      adminModal.setAttribute('aria-hidden','true');
    });

    adminSignInBtn.addEventListener('click', async () => {
      const email = adminEmail.value.trim();
      const pw = adminPassword.value;
      if(!email || !pw) return alert('Enter email and password');
      try{
        const cred = await auth.signInWithEmailAndPassword(email, pw);
        // Optionally check UID here against your admin UID
        sessionStorage.setItem('isAdmin','1');
        adminModal.classList.remove('open');
        adminModal.setAttribute('aria-hidden','true');
        adminEmail.value = ''; adminPassword.value = '';
        updateAdminUI();
        alert('Signed in as admin');
      }catch(err){
        alert('Sign in failed: ' + err.message);
      }
    });

    adminSignOutBtn.addEventListener('click', async () => {
      await auth.signOut();
      sessionStorage.removeItem('isAdmin');
      updateAdminUI();
      alert('Signed out');
    });

    // Keep UI in sync with auth state
    auth.onAuthStateChanged(user => {
      if(user){
        // Optionally verify user.uid equals your admin UID
        sessionStorage.setItem('isAdmin','1');
      } else {
        sessionStorage.removeItem('isAdmin');
      }
      updateAdminUI();
    });

    function updateAdminUI(){
      const admin = isAdmin();
      // show/hide admin-only controls
      document.querySelectorAll('.icon[data-action="edit"]').forEach(el => el.style.display = admin ? 'inline-grid' : 'none');
      deleteLinkBtn.style.display = admin ? 'inline-block' : 'none';
      addBtn.style.display = admin ? 'inline-flex' : 'none';
      editProfileBtn.style.display = admin ? 'inline-flex' : 'none';
      avatarEdit.style.display = admin ? 'block' : 'none';
      // admin modal buttons
      adminSignOutBtn.style.display = admin ? 'inline-flex' : 'none';
      adminSignInBtn.style.display = admin ? 'none' : 'inline-flex';
      // admin badge
      if(admin && !document.getElementById('adminBadge')){
        const b = document.createElement('div'); b.id='adminBadge'; b.className='adminBadge'; b.textContent='ADMIN'; document.querySelector('.controls').appendChild(b);
      } else if(!admin && document.getElementById('adminBadge')){
        document.getElementById('adminBadge').remove();
      }
    }

    /***** Utilities *****/
    function escapeHtml(s){ return String(s || '').replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

    document.addEventListener('keydown', (e) => {
      if(e.key.toLowerCase() === 'n' && !modal.classList.contains('open') && isAdmin()){
        addBtn.click();
      }
      if(e.key === 'Escape' && modal.classList.contains('open')) closeEditor();
    });

    /***** Init *****/
    (async function init(){
      // Load public data from Firestore or local fallback
      links = loadLinksLocal();
      loadProfileToUI();
      render();
      await loadFromServerOrLocal();
    })();

    /***** Notes for you *****
      - Upload images to your repo under /assets and deploy (Netlify or GitHub Pages).
      - Example image URL: https://<your-site>.netlify.app/assets/avatar.png
      - In Firestore rules, restrict writes to your admin UID:
        allow write: if request.auth != null && request.auth.uid == "YOUR_ADMIN_UID";
      - Replace firebaseConfig above with your project's config (already inserted).
    */
    let allLinks = [];

async function loadLinks() {
  const container = document.getElementById('links');
  try {
    const res = await fetch('/.netlify/functions/get-links');
    if (!res.ok) throw new Error('Failed to fetch links');
    const links = await res.json();
    allLinks = Array.isArray(links) ? links : [];
    renderLinks(allLinks);
  } catch (err) {
    console.error(err);
    container.innerHTML = '<div class="notice">Error loading links. Check function logs in Netlify.</div>';
  }
}

function renderLinks(list) {
  const container = document.getElementById('links');
  if (!list.length) {
    container.innerHTML = '<div class="notice">No links yet. Add some from the admin page.</div>';
    return;
  }
  container.innerHTML = list.map(l => {
    const thumb = l.thumbnail ? escapeHtml(l.thumbnail) : '/assets/default.png';
    const title = escapeHtml(l.title || l.url);
    const url = escapeHtml(l.url || '#');
    const tags = (l.tags || []).map(t => escapeHtml(t)).join(', ');
    return `
      <article class="card">
        <a href="${url}" target="_blank" rel="noopener noreferrer">
          <img class="thumb" src="${thumb}" alt="${title}">
        </a>
        <a class="title" href="${url}" target="_blank" rel="noopener noreferrer">${title}</a>
        <div class="meta">${tags || ''}</div>
      </article>
    `;
  }).join('');
}

function escapeHtml(s) {
  return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#39;');
}

document.addEventListener('DOMContentLoaded', loadLinks);

  </script>
</body>
</html>
